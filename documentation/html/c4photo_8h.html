<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BioCro: src/c4photo.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BioCro
   &#160;<span id="projectnumber">0.92</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c4photo_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">c4photo.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="c4photo_8h__dep__incl.png" border="0" usemap="#src_2c4photo_8hdep" alt=""/></div>
<map name="src_2c4photo_8hdep" id="src_2c4photo_8hdep">
<area shape="rect" id="node3" href="_aux_bio_cro_8c.html" title="src/AuxBioCro.c" alt="" coords="5,83,123,112"/><area shape="rect" id="node5" href="_auxcane_gro_8c.html" title="src/AuxcaneGro.c" alt="" coords="147,83,272,112"/><area shape="rect" id="node7" href="c3_can_a_8c.html" title="src/c3CanA.c" alt="" coords="296,83,397,112"/><area shape="rect" id="node9" href="c4photo_8c.html" title="src/c4photo.c" alt="" coords="421,83,523,112"/><area shape="rect" id="node11" href="_can_a_8c.html" title="src/CanA.c" alt="" coords="547,83,635,112"/></map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structc4__str.html">c4_str</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a117eb09a92cb1d21d3fd53c34cad3098"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="c4photo_8h.html#a117eb09a92cb1d21d3fd53c34cad3098">fnpsvp</a> (double Tkelvin)</td></tr>
<tr class="memitem:ad252ecbdbb24d814dab3373a3f101b49"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="c4photo_8h.html#ad252ecbdbb24d814dab3373a3f101b49">ballBerry</a> (double Amu, double Cappm, double Temp, double RelH, double beta0, double beta1)</td></tr>
<tr class="memitem:ae71c7850944d255a9b995a06fdb305aa"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structc4__str.html">c4_str</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="c4photo_8h.html#ae71c7850944d255a9b995a06fdb305aa">c4photoC</a> (double Qp, double Tl, double RH, double vmax, double alpha, double kparm, double theta, double beta, double Rd, double bb0, double bb1, double StomaWS, double Ca, int ws, double upperT, double lowerT)</td></tr>
<tr class="memitem:a764df7753151dc1e631cfeb85ff2b473"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="c4photo_8h.html#a764df7753151dc1e631cfeb85ff2b473">RSS_C4photo</a> (double oAssim[<a class="el" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a>], double oQp[<a class="el" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a>], double oTemp[<a class="el" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a>], double oRH[<a class="el" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a>], double vmax, double alpha, double kparm, double theta, double beta, double Rd, double Catm, double b0, double b1, double StomWS, int ws, double upperT, double lowerT)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a29aa87abb47cbc614f79d8b48185d41a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a></td></tr>
</table>
<h2>Function Documentation</h2>
<a class="anchor" id="ad252ecbdbb24d814dab3373a3f101b49"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ballBerry </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Amu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Cappm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Temp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>RelH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>beta0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>beta1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="#L106">106</a> of file <a class="el" href="">c4photo.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> gbw = 1.2; <span class="comment">/* According to Collatz et al. (1992) pg. 526*/</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> ptotPa = 101325; <span class="comment">/* Atmospheric pressure */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> pwaPa, leafTk, Camf, assimn;</div>
<div class="line">        <span class="keywordtype">double</span> wa, pwi, wi, gswmol, Cs, acs;</div>
<div class="line">        <span class="keywordtype">double</span> aaa, bbb, ccc, ddd;</div>
<div class="line">        <span class="keywordtype">double</span> gsmol;</div>
<div class="line">        <span class="keywordtype">double</span> hs;</div>
<div class="line"></div>
<div class="line">        leafTk = Temp + 273.15;</div>
<div class="line">        pwi = <a class="code" href="c3photo_8h.html#a117eb09a92cb1d21d3fd53c34cad3098">fnpsvp</a>(leafTk);</div>
<div class="line">        pwaPa = RelH * pwi;</div>
<div class="line">        Camf = Cappm * 1e-6;</div>
<div class="line">        assimn = Amu * 1e-6;</div>
<div class="line">  </div>
<div class="line">        <span class="comment">/* Calculate mole fraction (mixing ratio) of water vapor in */</span></div>
<div class="line">        <span class="comment">/* atmosphere from partial pressure of water in the atmosphere and*/</span></div>
<div class="line">        <span class="comment">/* the total air pressure */</span></div>
<div class="line">        wa  = pwaPa / ptotPa;</div>
<div class="line">        <span class="comment">/* Get saturation vapor pressure for water in the leaf based on */</span></div>
<div class="line">        <span class="comment">/* current idea of the leaf temperature in Kelvin*/</span></div>
<div class="line">        <span class="comment">/* Already calculated above */</span></div>
<div class="line">        <span class="comment">/* Calculate mole fraction of water vapor in leaf interior */</span></div>
<div class="line">        wi  = pwi / ptotPa;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(assimn &lt; 0.0){</div>
<div class="line">                <span class="comment">/* Set stomatal conductance to the minimum value, beta0*/</span></div>
<div class="line">                gswmol = beta0 ;</div>
<div class="line">                <span class="comment">/* Calculate leaf surface relative humidity, hs, (as fraction)*/</span></div>
<div class="line">                <span class="comment">/* for when C assimilation rate is &lt;= 0*/</span></div>
<div class="line">                <span class="comment">/* hs = (beta0 + (wa/wi)*gbw)/(beta0 + gbw); ! unused here??*/</span></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span>{</div>
<div class="line">                <span class="comment">/* leaf surface CO2, mole fraction */</span></div>
<div class="line">                Cs  = Camf - (1.4/gbw)*assimn;</div>
<div class="line">                <span class="keywordflow">if</span>(Cs &lt; 0.0)</div>
<div class="line">                        Cs = 1;</div>
<div class="line">                <span class="comment">/* Constrain the ratio assimn/cs to be &gt; 1.e-6*/</span></div>
<div class="line">                acs = assimn/Cs;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(acs &lt; 1e-6)  acs = 1e-6;             </div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Calculate leaf surface relative humidity, hs, from quadratic */</span></div>
<div class="line">                <span class="comment">/* equation: aaa*hs^2 + bbb*hs + ccc = 0 */</span></div>
<div class="line">                <span class="comment">/*  aaa= beta1 * assimn / cs */</span></div>
<div class="line">                aaa = beta1 * acs;</div>
<div class="line">                <span class="comment">/*      bbb= beta0 + gbw - (beta1 * assimn / cs)*/</span></div>
<div class="line">                bbb = beta0 + gbw - (beta1 * acs);</div>
<div class="line">                ccc = -(wa / wi) * gbw - beta0;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Solve the quadratic equation for leaf surface relative humidity */</span></div>
<div class="line">                <span class="comment">/* (as fraction) */</span></div>
<div class="line">                ddd = bbb * bbb - 4*aaa*ccc;</div>
<div class="line"></div>
<div class="line">                hs  = (-bbb + sqrt(ddd)) / (2* aaa);</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Ball-Berry equation (Collatz&#39;91, eqn 1) */</span></div>
<div class="line">                gswmol = beta1 * hs * acs + beta0;</div>
<div class="line">        }</div>
<div class="line">        gsmol = gswmol * 1000; <span class="comment">/* converting to mmol */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(gsmol &lt;= 0) gsmol = 1e-5;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span>(gsmol);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae71c7850944d255a9b995a06fdb305aa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structc4__str.html">c4_str</a> c4photoC </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Qp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Tl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>RH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>vmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kparm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>theta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>beta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Rd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bb0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bb1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>StomaWS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Ca</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ws</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>upperT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lowerT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="#L195">195</a> of file <a class="el" href="">c4photo.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structc4__str.html">c4_str</a> tmp;</div>
<div class="line">        <span class="comment">/* Constants */</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> AP = 101325; <span class="comment">/*Atmospheric pressure According to wikipedia (Pa)*/</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> P = AP / 1e3; <span class="comment">/* kPa */</span></div>
<div class="line">        <span class="comment">/*const double PS = 38;   Atmospheric pressure of CO2 */</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> Q10 = 2;  <span class="comment">/* Q10 increase in a reaction by 10 C temp */</span></div>
<div class="line">        <span class="comment">/* Defining biochemical variables */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> Csurface ;</div>
<div class="line">        <span class="keywordtype">double</span> InterCellularCO2 ;</div>
<div class="line">        <span class="keywordtype">double</span> KQ10 , kT ;</div>
<div class="line">        <span class="keywordtype">double</span> Vtn , Vtd , VT ;</div>
<div class="line">        <span class="keywordtype">double</span> Rtn , Rtd , RT ;</div>
<div class="line">        <span class="keywordtype">double</span> b0 , b1 , b2 ;</div>
<div class="line">        <span class="keywordtype">double</span> M1 , M2 , M ;</div>
<div class="line">        <span class="keywordtype">int</span> iterCounter ;</div>
<div class="line">        <span class="keywordtype">double</span> Quada , Quadb , Quadc ;</div>
<div class="line">        <span class="keywordtype">double</span> a2 , <a class="code" href="structc4__str.html#a7adeee8f55ac1ffe5e9c226823ae4251">Assim</a> ,<a class="code" href="structc4__str.html#ac2cb333c4e7bdd22c4c9672c80ed977f">GrossAssim</a>;</div>
<div class="line">        <span class="keywordtype">double</span> csurfaceppm ;</div>
<div class="line">        <span class="keywordtype">double</span> <a class="code" href="structc4__str.html#ac72aab455ed835560d5b9afd64c777eb">Gs</a> , miC = 0.0 ;</div>
<div class="line">        <span class="keywordtype">double</span> diff, OldAssim = 0.0, Tol = 0.1;</div>
<div class="line">        <span class="keywordtype">double</span> kT_IC_P;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* When the method does not converge I do not use the iterative solution*/</span></div>
<div class="line">        <span class="keywordtype">double</span> Assim0 = 0.0;</div>
<div class="line">        <span class="keywordtype">double</span> Gs0 = 0.0;</div>
<div class="line">        <span class="keywordtype">double</span> IntCO2 = 0.0;</div>
<div class="line">        <span class="comment">/* partial pressure of CO2 at the leaf surface */</span></div>
<div class="line">  </div>
<div class="line">        <span class="comment">/* if(StomaWS &lt; 0.5) ws = 0; */</span></div>
<div class="line"></div>
<div class="line">        Csurface = (Ca * 1e-6) * AP ;</div>
<div class="line">  </div>
<div class="line">        InterCellularCO2 = Csurface * 0.4; <span class="comment">/* Initial guestimate */</span></div>
<div class="line"></div>
<div class="line">        KQ10 =  pow(Q10,((Tl - 25.0) / 10.0));</div>
<div class="line"></div>
<div class="line">        kT = kparm * KQ10;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* First chunk of code see Collatz (1992) */</span></div>
<div class="line"><span class="comment">//      Vtn = vmax * pow(2,((Tl-25.0)/10.0));</span></div>
<div class="line"><span class="comment">//      Vtd = ( 1 + exp(0.3 * (3.0-Tl)) ) * (1 + exp( 0.3*(Tl-37.5) ));</span></div>
<div class="line"><span class="comment">//      VT  = Vtn / Vtd;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//       This is the code implementing temperature limitations</span></div>
<div class="line">         Vtn = vmax * pow(2,((Tl-25.0)/10.0));</div>
<div class="line">         Vtd = ( 1 + exp(0.3 * (lowerT-Tl)) ) * (1 + exp( 0.3*(Tl-upperT) ));</div>
<div class="line">         VT  = Vtn / Vtd;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Second chunk of code see Collatz (1992) */</span></div>
<div class="line">        Rtn = Rd * pow(2 , (Tl-25)/10 ) ;</div>
<div class="line">        Rtd =  1 + exp( 1.3 * (Tl-55) ) ;</div>
<div class="line">        RT = Rtn / Rtd ; </div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Third chunk of code again see Collatz (1992) */</span></div>
<div class="line">        b0 = VT * alpha  * Qp ;</div>
<div class="line">        b1 = VT + alpha  * Qp ;</div>
<div class="line">        b2 = theta ;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Calculate the 2 roots */</span></div>
<div class="line">        M1 = (b1 + sqrt(b1*b1 - (4 * b0 * b2)))/(2*b2) ;</div>
<div class="line">        M2 = (b1 - sqrt(b1*b1 - (4 * b0 * b2)))/(2*b2) ;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* This piece of code selects the smalles root */</span></div>
<div class="line">        <span class="keywordflow">if</span>(M1 &lt; M2)</div>
<div class="line">                M = M1;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                M = M2;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Here the iterations will start */</span></div>
<div class="line">        iterCounter = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">while</span>(iterCounter &lt; 50)</div>
<div class="line">        {</div>
<div class="line"></div>
<div class="line">                kT_IC_P = kT * (InterCellularCO2 / P*1000);</div>
<div class="line">                Quada = M * kT_IC_P;</div>
<div class="line">                Quadb = M + kT_IC_P;</div>
<div class="line">                Quadc = beta ;</div>
<div class="line"></div>
<div class="line">                a2 = (Quadb - sqrt(Quadb*Quadb - (4 * Quada * Quadc))) / (2 * Quadc);</div>
<div class="line"></div>
<div class="line">                Assim = a2 - RT;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(ws == 0) Assim *= StomaWS; </div>
<div class="line"></div>
<div class="line">                <span class="comment">/* milimole per meter square per second*/</span></div>
<div class="line">                csurfaceppm = Csurface * 10 ;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Need to create the Ball-Berry function */</span></div>
<div class="line">                Gs =  <a class="code" href="c3photo_8h.html#ad252ecbdbb24d814dab3373a3f101b49">ballBerry</a>(Assim,csurfaceppm, Tl, RH, bb0, bb1) ;</div>
<div class="line">                <span class="keywordflow">if</span>(ws == 1) Gs *= StomaWS; </div>
<div class="line"></div>
<div class="line">                InterCellularCO2 = Csurface - (Assim * 1e-6 * 1.6 * AP) / (Gs * 0.001);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(InterCellularCO2 &lt; 0)</div>
<div class="line">                        InterCellularCO2 = 1e-5;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(iterCounter == 0){</div>
<div class="line">                        Assim0 = <a class="code" href="structc4__str.html#a7adeee8f55ac1ffe5e9c226823ae4251">Assim</a>;</div>
<div class="line">                        Gs0 = <a class="code" href="structc4__str.html#ac72aab455ed835560d5b9afd64c777eb">Gs</a>;</div>
<div class="line">                        IntCO2 = InterCellularCO2;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                diff = OldAssim - <a class="code" href="structc4__str.html#a7adeee8f55ac1ffe5e9c226823ae4251">Assim</a>;</div>
<div class="line">                <span class="keywordflow">if</span>(diff &lt; 0) diff = -diff;</div>
<div class="line">                <span class="keywordflow">if</span>(diff &lt; Tol){</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }<span class="keywordflow">else</span>{</div>
<div class="line">                        OldAssim = <a class="code" href="structc4__str.html#a7adeee8f55ac1ffe5e9c226823ae4251">Assim</a>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                iterCounter++;</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="comment">/* This would ignore the optimization due to the iterative procedure</span></div>
<div class="line"><span class="comment"> * when it does not converge. It is turned off now*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* if(diff &gt; Tol){ */</span></div>
<div class="line">        <span class="comment">/*      Assim = Assim0; */</span></div>
<div class="line">        <span class="comment">/*      Gs = Gs0; */</span></div>
<div class="line">        <span class="comment">/*      InterCellularCO2 = IntCO2; */</span></div>
<div class="line">        <span class="comment">/* } */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* if(diff &gt; Tol){ */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;iter %.i diff %.3f \n&quot;,iterCounter,diff); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;%.2f %.2f %.2f %.2f \n&quot;, Qp, Tl, RH, StomaWS); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;StomWS %.2f \n&quot;,StomaWS); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;InterCellular CO2 %.2f \n&quot;,InterCellularCO2); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;Assim %.2f \n&quot;,Assim); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;miC %.2f \n&quot;,(InterCellularCO2/AP)*1e6); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;vmax %.1f alpha %.3f \n&quot;, vmax, alpha); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;kparm %.3f theta %.3f \n&quot;, kparm, theta); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;beta %.3f Rd %.3f \n&quot;, beta, Rd); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;bb0 %.3f bb1 %.3f \n&quot;, bb0, bb1); */</span></div>
<div class="line">        <span class="comment">/*      Rprintf(&quot;Ca %.1f ws %i \n&quot;, Ca, ws); */</span></div>
<div class="line">        <span class="comment">/*      error(&quot;Did not converge \n&quot;); */</span></div>
<div class="line">        <span class="comment">/* } */</span></div>
<div class="line"></div>
<div class="line">        miC = (InterCellularCO2 / AP) * 1e6 ;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(Gs &gt; 600)</div>
<div class="line">          Gs = 600;</div>
<div class="line">  GrossAssim=Assim+RT;</div>
<div class="line">        tmp.Assim = <a class="code" href="structc4__str.html#a7adeee8f55ac1ffe5e9c226823ae4251">Assim</a>;</div>
<div class="line">        tmp.Gs = <a class="code" href="structc4__str.html#ac72aab455ed835560d5b9afd64c777eb">Gs</a>;</div>
<div class="line">        tmp.Ci = miC;</div>
<div class="line">  tmp.GrossAssim=<a class="code" href="structc4__str.html#ac2cb333c4e7bdd22c4c9672c80ed977f">GrossAssim</a>;</div>
<div class="line">        <span class="keywordflow">return</span>(tmp);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a117eb09a92cb1d21d3fd53c34cad3098"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double fnpsvp </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Tkelvin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="#L176">176</a> of file <a class="el" href="">c4photo.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">        <span class="comment">/* water boiling point = 373.16 oK*/</span></div>
<div class="line"><span class="comment">/* This is the Arden Buck Equation </span></div>
<div class="line"><span class="comment">http://en.wikipedia.org/wiki/Arden_Buck_equation</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">        <span class="keywordtype">double</span> u, v;</div>
<div class="line">        <span class="keywordtype">double</span> tmp, esat;</div>
<div class="line"></div>
<div class="line">        tmp = Tkelvin - 273.15;</div>
<div class="line">        u = (18.678 - tmp/234.5)*tmp;</div>
<div class="line">        v = 257.14 + tmp;</div>
<div class="line">        esat = 6.1121 * exp(u/v);</div>
<div class="line">        esat /= 10;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span>(esat);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a764df7753151dc1e631cfeb85ff2b473"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double RSS_C4photo </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>oAssim</em>[nObs], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>oQp</em>[nObs], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>oTemp</em>[nObs], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>oRH</em>[nObs], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>vmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kparm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>theta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>beta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Rd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Catm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>b0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>b1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>StomWS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ws</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>upperT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lowerT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="#L486">486</a> of file <a class="el" href="">c4photo.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                                   { <span class="comment">/*\ref{eqn:Rd}*/</span></div>
<div class="line">        <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a>;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structc4__str.html">c4_str</a> tmp;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <span class="keywordtype">double</span> RSS = 0.0, diff = 0.0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span>(i = 0;i &lt; <a class="code" href="c4photo_8h.html#a29aa87abb47cbc614f79d8b48185d41a">nObs</a>; i++){</div>
<div class="line"></div>
<div class="line">                tmp = <a class="code" href="c4photo_8c.html#ae71c7850944d255a9b995a06fdb305aa">c4photoC</a>(oQp[i],oTemp[i],oRH[i],vmax,alpha,kparm,theta, beta, Rd,b0,b1,StomWS,Catm,ws,upperT,lowerT);</div>
<div class="line">                diff = oAssim[i] - tmp.Assim;</div>
<div class="line">                RSS += diff * diff;</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span>(RSS);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a29aa87abb47cbc614f79d8b48185d41a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nObs</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="#L6">6</a> of file <a class="el" href="">c4photo.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="c4photo_8h.html">c4photo.h</a></li>
    <li class="footer">Generated on Wed Jan 22 2014 09:27:25 for BioCro by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
