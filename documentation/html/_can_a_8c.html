<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BioCro: src/CanA.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BioCro
   &#160;<span id="projectnumber">0.92</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_can_a_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">CanA.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;R.h&gt;</code><br/>
<code>#include &lt;Rinternals.h&gt;</code><br/>
<code>#include &lt;Rmath.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="">c4photo.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="">AuxBioCro.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="">CanA.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for CanA.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="_can_a_8c__incl.png" border="0" usemap="#src_2_can_a_8c" alt=""/></div>
<map name="src_2_can_a_8c" id="src_2_can_a_8c">
<area shape="rect" id="node11" href="c4photo_8h.html" title="c4photo.h" alt="" coords="368,83,445,112"/><area shape="rect" id="node13" href="_aux_bio_cro_8h.html" title="AuxBioCro.h" alt="" coords="469,83,565,112"/><area shape="rect" id="node15" href="_can_a_8h.html" title="CanA.h" alt="" coords="589,83,656,112"/></map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2f1e86c592cffcb577cfa8ff4ecce824"><td class="memItemLeft" align="right" valign="top">SEXP&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_can_a_8c.html#a2f1e86c592cffcb577cfa8ff4ecce824">CanA</a> (SEXP Lai, SEXP Doy, SEXP HR, SEXP SOLAR, SEXP TEMP, SEXP ReH, SEXP windspeed, SEXP LAT, SEXP NLAYERS, SEXP STOMATAWS, SEXP VMAX, SEXP ALPH, SEXP KPARM, SEXP THETA, SEXP BETA, SEXP RD, SEXP B0, SEXP B1, SEXP CATM, SEXP KD, SEXP HEIGHTF, SEXP WS, SEXP LEAFN, SEXP KPLN, SEXP LNB0, SEXP LNB1, SEXP LNFUN, SEXP CHIL, SEXP UPPERTEMP, SEXP LOWERTEMP, SEXP NNITROP)</td></tr>
</table>
<h2>Function Documentation</h2>
<a class="anchor" id="a2f1e86c592cffcb577cfa8ff4ecce824"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SEXP CanA </td>
          <td>(</td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>Lai</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>Doy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>HR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>SOLAR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>TEMP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>ReH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>windspeed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>NLAYERS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>STOMATAWS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>VMAX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>ALPH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>KPARM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>THETA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>BETA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>RD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>B0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>B1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>CATM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>KD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>HEIGHTF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>WS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>LEAFN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>KPLN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>LNB0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>LNB1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>LNFUN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>CHIL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>UPPERTEMP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>LOWERTEMP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SEXP&#160;</td>
          <td class="paramname"><em>NNITROP</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="#L21">21</a> of file <a class="el" href="">CanA.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">double</span> upperT=REAL(UPPERTEMP)[0];</div>
<div class="line">    <span class="keywordtype">double</span> lowerT=REAL(LOWERTEMP)[0];</div>
<div class="line"><span class="comment">/* Declaring the struct for the Evaop Transpiration */</span></div>
<div class="line">   <span class="keyword">struct </span><a class="code" href="struct_e_t___str.html">ET_Str</a> tmp5_ET , tmp6_ET; </div>
<div class="line">   <span class="keyword">struct </span><a class="code" href="structc4__str.html">c4_str</a> tmpc4, tmpc42; </div>
<div class="line">   <span class="comment">//NITROPARMS STRUCTURE IS PASSED and READ</span></div>
<div class="line">  <span class="keyword">struct </span><a class="code" href="structnitro_parms.html">nitroParms</a> nitroparms;</div>
<div class="line">        <span class="keywordtype">double</span> TEMPdoubletoint;</div>
<div class="line">        nitroparms.<a class="code" href="structnitro_parms.html#a81548389d7bb414fbf85c27cc1df21ad">ileafN</a>=REAL(NNITROP)[0];</div>
<div class="line">        nitroparms.kln=REAL(NNITROP)[1];</div>
<div class="line">        nitroparms.Vmaxb1=REAL(NNITROP)[2];</div>
<div class="line">        nitroparms.Vmaxb0=REAL(NNITROP)[3];</div>
<div class="line">        nitroparms.alphab1=REAL(NNITROP)[4];</div>
<div class="line">        nitroparms.alphab0=REAL(NNITROP)[5];</div>
<div class="line">        nitroparms.Rdb1=REAL(NNITROP)[6];</div>
<div class="line">        nitroparms.Rdb0=REAL(NNITROP)[7];</div>
<div class="line">        nitroparms.kpLN=REAL(NNITROP)[8];</div>
<div class="line">        nitroparms.lnb0=REAL(NNITROP)[9];</div>
<div class="line">        nitroparms.lnb1=REAL(NNITROP)[10];</div>
<div class="line">        TEMPdoubletoint=REAL(NNITROP)[11];</div>
<div class="line">        nitroparms.lnFun=(int)TEMPdoubletoint;</div>
<div class="line">        nitroparms.maxln=REAL(NNITROP)[12];</div>
<div class="line">        nitroparms.minln=REAL(NNITROP)[13];</div>
<div class="line">        nitroparms.daymaxln=REAL(NNITROP)[14];</div>
<div class="line"></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> cf = 3600 * 1e-6 * 30 * 1e-6 * 10000;</div>
<div class="line"><span class="comment">/* Need a different conversion factor for transpiration */</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> cf2 = 3600 * 1e-3 * 18 * 1e-6 * 10000; </div>
<div class="line">  <span class="comment">/* 3600 - number of seconds in an hour */</span></div>
<div class="line">  <span class="comment">/* 1e-3 - mili mols to mols */</span></div>
<div class="line">  <span class="comment">/* 18 - grams in one mol of H20 */</span></div>
<div class="line">  <span class="comment">/* 1e-6 - grams to mega grams */</span></div>
<div class="line">  <span class="comment">/* 10000 - meters in one hectare */</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <span class="keywordtype">double</span> Idir, Idiff, cosTh;</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="_bio_cro_8h.html#ac656f07a64aeba7d6ac5a3a536e993c8">LAIc</a>;</div>
<div class="line">  <span class="keywordtype">double</span> IDir, IDiff, Itot,rh, WindS;</div>
<div class="line">  <span class="keywordtype">double</span> TempIdir,TempIdiff,AssIdir,AssIdiff,GAssIdir,GAssIdiff;</div>
<div class="line">  <span class="keywordtype">double</span> pLeafsun, pLeafshade;</div>
<div class="line">  <span class="keywordtype">double</span> Leafsun, Leafshade;</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> CanopyA,GCanopyA ;</div>
<div class="line">  <span class="keywordtype">double</span> CanopyT , CanopyPe = 0.0, CanopyPr = 0.0;</div>
<div class="line">  <span class="keywordtype">double</span> CanopyC = 0.0;</div>
<div class="line">  <span class="keywordtype">double</span> CanHeight;</div>
<div class="line">  <span class="comment">/* Need to label them something different from the arguments of the c4photoC</span></div>
<div class="line"><span class="comment">     function because these need to be modified by the water stress effect on</span></div>
<div class="line"><span class="comment">     the stomata and assimilation. The Ball-Berry parameters are not implemented</span></div>
<div class="line"><span class="comment">     yet (I need to think about this a bit harder). */</span></div>
<div class="line">  <span class="keywordtype">double</span> vmax1;</div>
<div class="line">  <span class="keywordtype">double</span> leafN_lay;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* INTEGERS */</span></div>
<div class="line">  <span class="keywordtype">int</span> DOY = INTEGER(Doy)[0];</div>
<div class="line">  <span class="keywordtype">int</span> hr = INTEGER(HR)[0];</div>
<div class="line">  <span class="keywordtype">int</span> nlayers = INTEGER(NLAYERS)[0];</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* REALS */</span></div>
<div class="line">  <span class="keywordtype">double</span> LAI = REAL(Lai)[0];</div>
<div class="line">  <span class="keywordtype">double</span> solarR = REAL(SOLAR)[0];</div>
<div class="line">  <span class="keywordtype">double</span> Temp = REAL(TEMP)[0];</div>
<div class="line">  <span class="keywordtype">double</span> RlH = REAL(ReH)[0];</div>
<div class="line">  <span class="keywordtype">double</span> WindSpeed = REAL(windspeed)[0];</div>
<div class="line">  <span class="keywordtype">double</span> lat = REAL(LAT)[0];</div>
<div class="line">  <span class="keywordtype">double</span> kd = REAL(KD)[0];</div>
<div class="line">  <span class="keywordtype">double</span> heightf = REAL(HEIGHTF)[0];</div>
<div class="line">  <span class="keywordtype">double</span> chil = REAL(CHIL)[0];</div>
<div class="line">  <span class="keywordtype">double</span> Catm = REAL(CATM)[0];</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Photosynthesis parameters */</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> alpha1 = REAL(ALPH)[0];</div>
<div class="line">  <span class="keywordtype">double</span> kparm1 = REAL(KPARM)[0];</div>
<div class="line">  <span class="keywordtype">double</span> theta = REAL(THETA)[0];</div>
<div class="line">  <span class="keywordtype">double</span> beta = REAL(BETA)[0];</div>
<div class="line">  <span class="keywordtype">double</span> Rd1 = REAL(RD)[0];</div>
<div class="line">  <span class="keywordtype">double</span> b01 = REAL(B0)[0];</div>
<div class="line">  <span class="keywordtype">double</span> b11 = REAL(B1)[0];</div>
<div class="line">  <span class="keywordtype">double</span> stomataws = REAL(STOMATAWS)[0];</div>
<div class="line">  <span class="keywordtype">double</span>  LeafN = REAL(LEAFN)[0];</div>
<div class="line">  <span class="keywordtype">double</span>  <a class="code" href="structnitro_parms.html#a89b04bb673ac5d9fd455e0b9317bdb83">kpLN</a> = REAL(KPLN)[0];</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="structnitro_parms.html#a980c24e01e429167687e2ab6191f4175">lnb0</a> = REAL(LNB0)[0];</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="structnitro_parms.html#a4020d72bf2f4de6d518eec319f123e2e">lnb1</a> = REAL(LNB1)[0];</div>
<div class="line">  <span class="keywordtype">int</span> lnfun = INTEGER(LNFUN)[0];</div>
<div class="line"></div>
<div class="line">  SEXP lists;</div>
<div class="line">  SEXP names;</div>
<div class="line">  SEXP growth;</div>
<div class="line">  SEXP Ggrowth;</div>
<div class="line">  SEXP trans;</div>
<div class="line">  SEXP epen;</div>
<div class="line">  SEXP epries;</div>
<div class="line">  SEXP cond;</div>
<div class="line"></div>
<div class="line">  SEXP mat1;</div>
<div class="line"></div>
<div class="line">  PROTECT(lists = allocVector(VECSXP,7));</div>
<div class="line">  PROTECT(names = allocVector(STRSXP,7));</div>
<div class="line">  PROTECT(growth = allocVector(REALSXP,1));</div>
<div class="line">  PROTECT(trans = allocVector(REALSXP,1));</div>
<div class="line">  PROTECT(epen = allocVector(REALSXP,1));</div>
<div class="line">  PROTECT(epries = allocVector(REALSXP,1));</div>
<div class="line">  PROTECT(cond = allocVector(REALSXP,1));</div>
<div class="line">  PROTECT(Ggrowth = allocVector(REALSXP,1));</div>
<div class="line">  PROTECT(mat1 = allocMatrix(REALSXP,19,nlayers));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Light Macro Environment. As a side effect it populates tmp1. This</span></div>
<div class="line"><span class="comment">   * should eventually be replaced by a structure. */</span></div>
<div class="line"></div>
<div class="line">     <a class="code" href="_aux_bio_cro_8c.html#a46827eb56108821fe82228553f535293">lightME</a>(lat,DOY,hr);</div>
<div class="line"></div>
<div class="line">    Idir = <a class="code" href="_aux_bio_cro_8h.html#aab252cacb5d92c011d673d2db55cba0d">tmp1</a>[0] * solarR;</div>
<div class="line">    Idiff = <a class="code" href="_aux_bio_cro_8h.html#aab252cacb5d92c011d673d2db55cba0d">tmp1</a>[1] * solarR;</div>
<div class="line">    cosTh = <a class="code" href="_aux_bio_cro_8h.html#aab252cacb5d92c011d673d2db55cba0d">tmp1</a>[2];</div>
<div class="line"></div>
<div class="line"><span class="comment">/* sun multilayer model. As a side effect it populates the layIdir, layItotal, layFsun, layHeight,</span></div>
<div class="line"><span class="comment">layIdiff, layShade vectors. */</span></div>
<div class="line">    </div>
<div class="line">    <a class="code" href="_aux_bio_cro_8c.html#acb415c4c261f9fc0140240ad46007c87">sunML</a>(Idir,Idiff,LAI,nlayers,cosTh,kd,chil,heightf);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* results from multilayer model */</span></div>
<div class="line">    LAIc = LAI / nlayers;</div>
<div class="line">    <span class="comment">/* Next I need the RH and wind profile */</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="_aux_bio_cro_8c.html#a247148ac54cf7d8c851326de6093b71e">RHprof</a>(RlH,nlayers);</div>
<div class="line">    <span class="comment">/* It populates tmp4. */</span></div>
<div class="line"></div>
<div class="line">     <a class="code" href="_aux_bio_cro_8c.html#a43b0d68a959084dc4f4dc099c8901107">WINDprof</a>(WindSpeed,LAI,nlayers);</div>
<div class="line">    <span class="comment">/* It populates tmp3. */</span></div>
<div class="line"></div>
<div class="line">     <a class="code" href="_aux_bio_cro_8c.html#aa65c89edaec63830e4dd568a89d12fa2">LNprof</a>(LeafN, LAI, nlayers, kpLN);</div>
<div class="line">    <span class="comment">/* It populates tmp5 */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Next use the EvapoTrans function */</span></div>
<div class="line">    CanopyA=0.0;</div>
<div class="line">    CanopyT=0.0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(i=0;i&lt;nlayers;i++)</div>
<div class="line">    {</div>
<div class="line"><span class="comment">/* vmax depends on leaf nitrogen and this in turn depends on the layer */</span></div>
<div class="line">            leafN_lay = <a class="code" href="_aux_bio_cro_8h.html#aaa2add75bf14b805a4da749043e7be33">tmp5</a>[--<a class="code" href="_aux_bio_cro_8h.html#a39f70a6dfb72439e2f4e0f03f27c0813">tp5</a>];</div>
<div class="line">    <span class="keywordflow">if</span>(lnfun == 0){</div>
<div class="line">                        vmax1 = REAL(VMAX)[0];</div>
<div class="line">                }<span class="keywordflow">else</span>{</div>
<div class="line">                        vmax1=nitroparms.Vmaxb1*leafN_lay+nitroparms.Vmaxb0;</div>
<div class="line">                        <span class="keywordflow">if</span>(vmax1&lt;0) vmax1=0.0;</div>
<div class="line">      <span class="keywordflow">if</span>(vmax1&gt;REAL(VMAX)[0]) vmax1=REAL(VMAX)[0];</div>
<div class="line">                        alpha1=nitroparms.alphab1*leafN_lay+nitroparms.alphab0;</div>
<div class="line">                        Rd1=nitroparms.Rdb1*leafN_lay+nitroparms.Rdb0;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            IDir = <a class="code" href="_aux_bio_cro_8h.html#ab0638a2083d3e8d4c1ac43a116da1ad8">layIdir</a>[--<a class="code" href="_aux_bio_cro_8h.html#a287f9452c1f62b4c5c9ec0616503fb8e">sp1</a>];</div>
<div class="line">            Itot = <a class="code" href="_aux_bio_cro_8h.html#a1e5f45a584d3c5541472f92c5875e4ea">layItotal</a>[--<a class="code" href="_aux_bio_cro_8h.html#a959c4cc4acdec59096dac039bfdb627b">sp3</a>];</div>
<div class="line">            </div>
<div class="line">            rh = <a class="code" href="_aux_bio_cro_8h.html#acfad88ff5207b2ab57fc1dca17271065">tmp4</a>[--<a class="code" href="_aux_bio_cro_8h.html#a36e4d9011835445995335074adedad9a">tp4</a>];</div>
<div class="line">            WindS = <a class="code" href="_aux_bio_cro_8h.html#a15219c620f8cdf6d8cf731e485e2c668">tmp3</a>[--<a class="code" href="_aux_bio_cro_8h.html#af8b40a97721000892ae5e0ac624af4c6">tp3</a>];</div>
<div class="line"></div>
<div class="line">            pLeafsun = <a class="code" href="_aux_bio_cro_8h.html#a029005f88756e3761a72c104fae0d57b">layFsun</a>[--<a class="code" href="_aux_bio_cro_8h.html#a25e1abfffbd0ba6bcb9e7d2b6c847c04">sp4</a>];</div>
<div class="line">            CanHeight = <a class="code" href="_aux_bio_cro_8h.html#a5ebe5f68c3871953059c08a083acdb9c">layHeight</a>[--<a class="code" href="_aux_bio_cro_8h.html#ac86af9361847656ad3514e64ad9e9842">sp6</a>];</div>
<div class="line">            Leafsun = LAIc * pLeafsun;</div>
<div class="line">            tmp5_ET = <a class="code" href="_aux_bio_cro_8c.html#a05f213f4cb25cf49735180ff3b883107">EvapoTrans</a>(IDir,Itot,Temp,rh,WindS,LAIc,CanHeight,stomataws,</div>
<div class="line">                                 INTEGER(WS)[0],vmax1,alpha1,kparm1,theta,beta,Rd1,b01,b11,upperT,lowerT);</div>
<div class="line">            TempIdir = Temp + tmp5_ET.Deltat;</div>
<div class="line">            tmpc4 = <a class="code" href="c4photo_8c.html#ae71c7850944d255a9b995a06fdb305aa">c4photoC</a>(IDir,TempIdir,rh,vmax1,alpha1,kparm1,theta,beta,Rd1,b01,b11,stomataws, Catm,INTEGER(WS)[0],upperT,lowerT);</div>
<div class="line">            AssIdir = tmpc4.Assim;</div>
<div class="line">      GAssIdir=tmpc4.GrossAssim;</div>
<div class="line"></div>
<div class="line">            IDiff = <a class="code" href="_aux_bio_cro_8h.html#a0b8103786ef18d899e25c932a2eb5b88">layIdiff</a>[--<a class="code" href="_aux_bio_cro_8h.html#a972c42de1800efab3685fc8a47e05da5">sp2</a>];</div>
<div class="line">            pLeafshade = <a class="code" href="_aux_bio_cro_8h.html#a5a00a948cd8575f53c71ee1f4b799da5">layFshade</a>[--<a class="code" href="_aux_bio_cro_8h.html#a048d95ccd2cc9d2f00c78c97343c9a6a">sp5</a>];</div>
<div class="line">            Leafshade = LAIc * pLeafshade;</div>
<div class="line">            tmp6_ET = <a class="code" href="_aux_bio_cro_8c.html#a05f213f4cb25cf49735180ff3b883107">EvapoTrans</a>(IDiff,Itot,Temp,rh,WindS,LAIc,CanHeight,</div>
<div class="line">                                 stomataws,INTEGER(WS)[0],vmax1,alpha1,kparm1,theta,beta,Rd1,b01,b11,upperT,lowerT);</div>
<div class="line">            TempIdiff = Temp + tmp6_ET.Deltat;</div>
<div class="line">            tmpc42 = <a class="code" href="c4photo_8c.html#ae71c7850944d255a9b995a06fdb305aa">c4photoC</a>(IDiff,TempIdiff,rh,vmax1,alpha1,kparm1,theta,beta,Rd1,b01,b11,stomataws, Catm,INTEGER(WS)[0],upperT,lowerT);</div>
<div class="line">            AssIdiff = tmpc42.Assim;</div>
<div class="line">      GAssIdiff = tmpc42.GrossAssim;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Collect direct radiation assim and trans in a matrix */</span></div>
<div class="line">            REAL(mat1)[i*19] = IDir;</div>
<div class="line">            REAL(mat1)[1 + i*19] = IDiff;</div>
<div class="line">            REAL(mat1)[2 + i*19] = Leafsun;</div>
<div class="line">            REAL(mat1)[3 + i*19] = Leafshade;</div>
<div class="line">            REAL(mat1)[4 + i*19] = tmp5_ET.TransR;</div>
<div class="line">            REAL(mat1)[5 + i*19] = tmp6_ET.TransR;</div>
<div class="line">            REAL(mat1)[6 + i*19] = AssIdir;</div>
<div class="line">            <span class="comment">/*REAL(mat1)[7 + i*19] = AssIdiff;*/</span></div>
<div class="line">      REAL(mat1)[7 + i*19] = AssIdiff;</div>
<div class="line">            REAL(mat1)[8 + i*19] = tmp5_ET.Deltat;</div>
<div class="line">            REAL(mat1)[9 + i*19] = tmp6_ET.Deltat;</div>
<div class="line">            REAL(mat1)[10 + i*19] = tmp5_ET.LayerCond; </div>
<div class="line">            REAL(mat1)[11 + i*19] = tmp6_ET.LayerCond; </div>
<div class="line">            REAL(mat1)[12 + i*19] = leafN_lay; </div>
<div class="line">            REAL(mat1)[13 + i*19] = vmax1;</div>
<div class="line">            REAL(mat1)[14 + i*19] = rh; </div>
<div class="line">      REAL(mat1)[15 + i*19] = GAssIdir;</div>
<div class="line">      REAL(mat1)[16 + i*19] = GAssIdiff;</div>
<div class="line">      REAL(mat1)[17 + i*19] = alpha1;</div>
<div class="line">      REAL(mat1)[18 + i*19] = leafN_lay;</div>
<div class="line"><span class="comment">/*      REAL(mat1)[11 + i*12] = rh;  */</span></div>
<div class="line">    <span class="comment">/*Layer conductance needs to be transformed back to the correct units here*/</span></div>
<div class="line"></div>
<div class="line">            CanopyA += Leafsun * AssIdir + Leafshade * AssIdiff;</div>
<div class="line">            CanopyT += Leafsun * tmp5_ET.TransR + Leafshade * tmp6_ET.TransR; </div>
<div class="line">            CanopyPe += Leafsun * tmp5_ET.EPenman + Leafshade * tmp6_ET.EPenman;</div>
<div class="line">            CanopyPr += Leafsun * tmp5_ET.EPriestly + Leafshade * tmp6_ET.EPriestly;</div>
<div class="line">            CanopyC += Leafsun * tmp5_ET.LayerCond + Leafshade * tmp6_ET.LayerCond;</div>
<div class="line">      GCanopyA += Leafsun * GAssIdir + Leafshade * GAssIdiff;</div>
<div class="line">    }</div>
<div class="line"> <span class="comment">/*## These are micro mols of CO2 per m2 per sec</span></div>
<div class="line"><span class="comment">   ## Need to convert to </span></div>
<div class="line"><span class="comment">   ## 3600 converts seconds to hours</span></div>
<div class="line"><span class="comment">   ## 10^-6 converts micro mols to mols</span></div>
<div class="line"><span class="comment">   ## 30 converts mols of CO2 to grams</span></div>
<div class="line"><span class="comment">   ## (1/10^6) converts grams to Mg</span></div>
<div class="line"><span class="comment">   ## 10000 scales up to ha */</span></div>
<div class="line">    REAL(growth)[0] = cf * CanopyA ;</div>
<div class="line">    REAL(trans)[0] = cf2 * CanopyT ;</div>
<div class="line">    REAL(epen)[0] = cf2 * CanopyPe ;</div>
<div class="line">    REAL(epries)[0] = cf2 * CanopyPr ;</div>
<div class="line">    REAL(cond)[0] = CanopyC;</div>
<div class="line">    REAL(Ggrowth)[0] = cf * GCanopyA ;</div>
<div class="line"></div>
<div class="line">    SET_VECTOR_ELT(lists,0,growth);</div>
<div class="line">    SET_VECTOR_ELT(lists,1,trans);</div>
<div class="line">    SET_VECTOR_ELT(lists,2,cond);</div>
<div class="line">    SET_VECTOR_ELT(lists,3,epen);</div>
<div class="line">    SET_VECTOR_ELT(lists,4,epries);</div>
<div class="line">    SET_VECTOR_ELT(lists,5,Ggrowth);</div>
<div class="line">    SET_VECTOR_ELT(lists,6,mat1);</div>
<div class="line"></div>
<div class="line">    SET_STRING_ELT(names,0,mkChar(<span class="stringliteral">&quot;CanopyAssim&quot;</span>));</div>
<div class="line">    SET_STRING_ELT(names,1,mkChar(<span class="stringliteral">&quot;CanopyTrans&quot;</span>));</div>
<div class="line">    SET_STRING_ELT(names,2,mkChar(<span class="stringliteral">&quot;CanopyCond&quot;</span>));</div>
<div class="line">    SET_STRING_ELT(names,3,mkChar(<span class="stringliteral">&quot;TranEpen&quot;</span>));</div>
<div class="line">    SET_STRING_ELT(names,4,mkChar(<span class="stringliteral">&quot;TranEpries&quot;</span>));</div>
<div class="line">    SET_STRING_ELT(names,5,mkChar(<span class="stringliteral">&quot;GrossCanopyAssim&quot;</span>));</div>
<div class="line">    SET_STRING_ELT(names,6,mkChar(<span class="stringliteral">&quot;LayMat&quot;</span>));</div>
<div class="line">    setAttrib(lists,R_NamesSymbol,names);</div>
<div class="line"></div>
<div class="line">    UNPROTECT(9);</div>
<div class="line">    <span class="keywordflow">return</span>(lists);</div>
<div class="line">   }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="_can_a_8c.html">CanA.c</a></li>
    <li class="footer">Generated on Wed Jan 22 2014 09:27:25 for BioCro by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
